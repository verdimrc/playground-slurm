+ sort
+ grep SLURM
+ env
SLURM_CLUSTER_NAME=hpc
SLURM_CONF=/opt/slurm/etc/slurm.conf
SLURM_CPUS_ON_NODE=1
SLURMD_NODENAME=compute-dy-compute-1
SLURM_GTIDS=0
SLURM_JOB_CPUS_PER_NODE=1(x2)
SLURM_JOB_GID=1000
SLURM_JOB_ID=21
SLURM_JOBID=21
SLURM_JOB_NAME=nemo-megatron.sbatch
SLURM_JOB_NODELIST=compute-dy-compute-[1-2]
SLURM_JOB_NUM_NODES=2
SLURM_JOB_PARTITION=compute
SLURM_JOB_UID=1000
SLURM_JOB_USER=ec2-user
SLURM_LOCALID=0
SLURM_NNODES=2
SLURM_NODE_ALIASES=(null)
SLURM_NODEID=0
SLURM_NODELIST=compute-dy-compute-[1-2]
SLURM_PRIO_PROCESS=0
SLURM_PROCID=0
SLURM_SUBMIT_DIR=/home/ec2-user/haha
SLURM_SUBMIT_HOST=ip-10-0-0-161
SLURM_TASK_PID=4444
SLURM_TASKS_PER_NODE=1(x2)
SLURM_TOPOLOGY_ADDR=compute-dy-compute-1
SLURM_TOPOLOGY_ADDR_PATTERN=node
SLURM_WORKING_CLUSTER=hpc:10.0.0.161:6820:9728:109
+ : haha
+ export SBATCH_HEHE=2
+ SBATCH_HEHE=2
++ egrep 'HAHA|HEHE'
++ env
+ echo -e /var/spool/slurmd/job00021/slurm_script env 'is\nSBATCH_HEHE=2
SBATCH_HAHA=haha'
/var/spool/slurmd/job00021/slurm_script env is
SBATCH_HEHE=2
SBATCH_HAHA=haha
+ echo 'nemo-megatron: SBATCH_HAHA=haha'
nemo-megatron: SBATCH_HAHA=haha
+ srun bash -c '
ADHOC_HEHE=456 ;
ADHOC_HAHA=123 /home/ec2-user/haha/run.sh
'
########
########
/home/ec2-user/haha/run.sh env is
SBATCH_HEHE=2
RUNSH_HEHE=/fsx/data/bpe
ADHOC_HAHA=123
SBATCH_HAHA=haha
manual echo SBATCH_HAHA: haha
manual echo RUNSH_HAHA: haha
manual echo ADHOC_HAHA: 123
manual echo ADHOC_HEHE:
SLURM_CLUSTER_NAME=hpc
SLURM_CONF=/opt/slurm/etc/slurm.conf
SLURM_CPU_BIND_LIST=0x1
SLURM_CPU_BIND=quiet,mask_cpu:0x1
SLURM_CPU_BIND_TYPE=mask_cpu:
SLURM_CPU_BIND_VERBOSE=quiet
SLURM_CPUS_ON_NODE=1
SLURM_DISTRIBUTION=cyclic
SLURMD_NODENAME=compute-dy-compute-1
SLURM_GTIDS=0
SLURM_JOB_CPUS_PER_NODE=1(x2)
SLURM_JOB_CPUS_PER_NODE_PACK_GROUP_0=1(x2)
SLURM_JOB_GID=1000
SLURM_JOB_ID=21
SLURM_JOBID=21
SLURM_JOB_NAME=nemo-megatron.sbatch
SLURM_JOB_NODELIST=compute-dy-compute-[1-2]
SLURM_JOB_NUM_NODES=2
SLURM_JOB_PARTITION=compute
SLURM_JOB_UID=1000
SLURM_JOB_USER=ec2-user
SLURM_LAUNCH_NODE_IPADDR=10.0.27.160
SLURM_LOCALID=0
SLURM_NNODES=2
SLURM_NODE_ALIASES=(null)
SLURM_NODEID=0
SLURM_NODELIST=compute-dy-compute-[1-2]
SLURM_NPROCS=2
SLURM_NTASKS=2
SLURM_PRIO_PROCESS=0
SLURM_PROCID=0
SLURM_SRUN_COMM_HOST=10.0.27.160
SLURM_SRUN_COMM_PORT=44345
SLURM_STEP_ID=0
SLURM_STEPID=0
SLURM_STEP_LAUNCHER_PORT=44345
SLURM_STEP_NODELIST=compute-dy-compute-[1-2]
SLURM_STEP_NUM_NODES=2
SLURM_STEP_NUM_TASKS=2
SLURM_STEP_TASKS_PER_NODE=1(x2)
SLURM_SUBMIT_DIR=/home/ec2-user/haha
SLURM_SUBMIT_HOST=ip-10-0-0-161
SLURM_TASK_PID=4465
SLURM_TASKS_PER_NODE=1(x2)
SLURM_TOPOLOGY_ADDR=compute-dy-compute-1
SLURM_TOPOLOGY_ADDR_PATTERN=node
SLURM_UMASK=0002
SLURM_WORKING_CLUSTER=hpc:10.0.0.161:6820:9728:109
========
========
########
########
/home/ec2-user/haha/run.sh env is
SBATCH_HEHE=2
RUNSH_HEHE=/fsx/data/bpe
ADHOC_HAHA=123
SBATCH_HAHA=haha
manual echo SBATCH_HAHA: haha
manual echo RUNSH_HAHA: haha
manual echo ADHOC_HAHA: 123
manual echo ADHOC_HEHE:
SLURM_CLUSTER_NAME=hpc
SLURM_CONF=/opt/slurm/etc/slurm.conf
SLURM_CPU_BIND_LIST=0x1
SLURM_CPU_BIND=quiet,mask_cpu:0x1
SLURM_CPU_BIND_TYPE=mask_cpu:
SLURM_CPU_BIND_VERBOSE=quiet
SLURM_CPUS_ON_NODE=1
SLURM_DISTRIBUTION=cyclic
SLURMD_NODENAME=compute-dy-compute-2
SLURM_GTIDS=1
SLURM_JOB_CPUS_PER_NODE=1(x2)
SLURM_JOB_CPUS_PER_NODE_PACK_GROUP_0=1(x2)
SLURM_JOB_GID=1000
SLURM_JOB_ID=21
SLURM_JOBID=21
SLURM_JOB_NAME=nemo-megatron.sbatch
SLURM_JOB_NODELIST=compute-dy-compute-[1-2]
SLURM_JOB_NUM_NODES=2
SLURM_JOB_PARTITION=compute
SLURM_JOB_UID=1000
SLURM_JOB_USER=ec2-user
SLURM_LAUNCH_NODE_IPADDR=10.0.27.160
SLURM_LOCALID=0
SLURM_NNODES=2
SLURM_NODE_ALIASES=(null)
SLURM_NODEID=1
SLURM_NODELIST=compute-dy-compute-[1-2]
SLURM_NPROCS=2
SLURM_NTASKS=2
SLURM_PRIO_PROCESS=0
SLURM_PROCID=1
SLURM_SRUN_COMM_HOST=10.0.27.160
SLURM_SRUN_COMM_PORT=44345
SLURM_STEP_ID=0
SLURM_STEPID=0
SLURM_STEP_LAUNCHER_PORT=44345
SLURM_STEP_NODELIST=compute-dy-compute-[1-2]
SLURM_STEP_NUM_NODES=2
SLURM_STEP_NUM_TASKS=2
SLURM_STEP_TASKS_PER_NODE=1(x2)
SLURM_SUBMIT_DIR=/home/ec2-user/haha
SLURM_SUBMIT_HOST=ip-10-0-0-161
SLURM_TASK_PID=4402
SLURM_TASKS_PER_NODE=1(x2)
SLURM_TOPOLOGY_ADDR=compute-dy-compute-2
SLURM_TOPOLOGY_ADDR_PATTERN=node
SLURM_UMASK=0002
SLURM_WORKING_CLUSTER=hpc:10.0.0.161:6820:9728:109
========
========
